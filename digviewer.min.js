/*DIGViewer 0.1, Copyright 2013-2016 McGill University. Licensed under the LGPL license.*/
var DIGViewer=function(t,a){"use strict";this.a={b:{c:26,d:26},e:{f:140,g:200},h:{f:200,i:200,j:15},k:{l:20,m:12},n:1},this.o=0,this.p=[],this.q=a&&a.q||"row",this.r=a&&a.r||function(){},this.s=a&&a.s||new DigViewerLabelDecorator,this.t=a&&a.t||function(){},this.u=a&&a.u||function(){},this.v=[],this.w=[],this.x=a&&a.x||"column",this.y=a&&a.y||function(){},this.z=a&&a.z||new DigViewerLabelDecorator,this.A=a&&a.A||function(){},this.B=a&&a.B||function(){},this.C=a&&a.C||function(){},this.D=a&&a.D||void 0,this.F=[],this.G=a&&a.G||function(){return"#AAA"},"displayBrackets"in a&&(this.a.n=a.n),this.H=a&&a.H||function(){},this.I=a&&a.I||function(){},this.J=a&&a.J||function(){},this.K=a&&a.K||"data",this.L={},this.M=!1,this.N=void 0;var n=this;this.O=t,this.P=d3.select(t),this.Q=this.P.append("div");var e,i;this.R=0,this.S=0,this.T=0,this.U=1,this.V=1,this.W=function(t,a,r,o,d){if(n.L=n.X(t),n.p=a,n.v=r,n.F=o,n.w=d,0===t.length)return n.Y(),void n.H();n.o=0;var s=d3.scale.linear();s.domain([0,30]),s.range([1,.6]),n.v.length>=n.a.k.l&&(n.o=n.v.length/n.a.k.m-1),n.T=Math.round(n.o),n.V=s(n.T)*this.U,n.R=(n.a.b.c-n.o)*n.v.length,n.S=(n.a.b.d-n.o)*n.p.length,e=d3.scale.ordinal().rangeBands([0,n.R]).domain(n.v.sort(n.A).map(function(t){return t.id})),i=d3.scale.ordinal().rangeBands([0,n.S]).domain(n.p.sort(n.t).map(function(t){return t.id})),n.Q.remove(),n.Q=n.P.append("div"),n.Z(),n.$(),n._(),n.H()},this.aa=function(t,a){t.ba=a,n.I(t,a)},this.ca=function(){n.ea.da(".cell").classed("active",function(t){return t.ba===!0})},this.fa=function(t){n.aa(t,!t.ba),n.ca(),n.J()},this.ga=function(t){var a=!0;for(var e in n.L[t.id])n.L[t.id].hasOwnProperty(e)&&(n.L[t.id][e].ba||(a=!1));var i=!a;for(var r in n.L[t.id])n.L[t.id].hasOwnProperty(r)&&n.aa(n.L[t.id][r],i);n.ca(),n.J()},this.ha=function(t){var a=!0;n.ea.da(".row").each(function(e){"undefined"!=typeof n.L[e.id]&&"undefined"!=typeof n.L[e.id][t.id]&&(n.L[e.id][t.id].ba||(a=!1))});var e=!a;n.ea.da(".row").each(function(a){"undefined"!=typeof n.L[a.id]&&"undefined"!=typeof n.L[a.id][t.id]&&n.aa(n.L[a.id][t.id],e)}),n.ca(),n.J()},this.ia=function(t){if("undefined"!=typeof n.D){var a=n.v.filter(function(a){return n.D(a.id).id.toString()===t}),e=!0;n.ea.da(".row").each(function(t){a.forEach(function(a){if("undefined"!=typeof n.L[t.id]&&a.id in n.L[t.id]){var i=n.L[t.id][a.id];i.ba||(e=!1)}})});var i=!e;n.ea.da(".row").each(function(t){a.forEach(function(a){"undefined"!=typeof n.L[t.id]&&a.id in n.L[t.id]&&n.aa(n.L[t.id][a.id],i)})}),n.ca(),n.J()}},this.ja=function(){d3.values(n.L).forEach(function(t){d3.values(t).forEach(function(t){t.ba=!1})}),n.ca(),n.J()},this.da=function(){d3.values(n.L).forEach(function(t){d3.values(t).forEach(function(t){n.aa(t,!0)})}),n.ca(),n.J()},this.ka=function(){var t=d3.da(".cell").filter(function(t){return t.ba});return t.data()},this.la=function(){e.domain(n.v.sort(n.A).map(function(t){return t.id})),i.domain(n.p.sort(n.t).map(function(t){return t.id})),d3.da(".backgroundRow").style("fill","#FFFFFF"),n.ea.da(".defs_y").remove();var t=n.ea.transition().duration(1e3).da(".row").delay(function(t){return.5*n.p.indexOf(t)}).attr("transform",function(t){return"translate(0,"+i(t.id)+")"});if(n.ea.transition().duration(1e3).da(".cell").delay(function(t){return.5*n.v.indexOf(t)}).attr("x",function(t){return e(t[n.x])}),n.ea.transition().duration(1e3).da(".column").delay(function(t){return.5*n.v.indexOf(t)}).attr("transform",function(t){return"translate("+e(t.id)+")rotate(-90)"}),n.s.ma()>0){for(var a=0;a<n.s.ma();a++)n.na("y",a,0,.35);t.da(".backgroundRow").style("fill",function(t){var a=n.s.oa(t);return null!==a?"url(#"+a+")":"white"});for(var r=0;r<n.s.ma();r++){var o=n.s.pa(r);d3.select("#gradient_y_"+r).select("#stop2").transition().delay(1500).duration(1500).attr("stop-color",o)}}},this.X=function(t){var a={};return t.forEach(function(t){var e=t[n.q],i=t[n.x];if("undefined"==typeof a[e]&&(a[e]={}),"undefined"!=typeof a[e][i])throw Error("Multiple data objects for the same row/column combination: row '"+e+"' col '"+i+"'");a[e][i]=t}),a},this.Z=function(){n.ea=n.Q.append("svg").attr("width",Math.max(n.R+2*n.a.e.g,n.O.offsetWidth-10)).attr("height",Math.max(n.S+n.a.h.i+10,n.O.offsetHeight-10)).on("mouseup",n.qa).on("mouseleave",n.qa).append("g").attr("transform","translate("+1.2*n.a.e.g+","+n.a.h.i+")"),n.ea.append("rect").attr("class","background cell_border").attr("id","gridBackground").attr("width",n.R).attr("height",n.S).attr("pointer-events","none")},this.$=function(){var t=n.ea.da(".row").data(n.p).enter().append("g").attr("class",function(t,a){var e=n.u(t,a);return e+=" row"}).attr("transform",function(t){return"translate(0,"+i(t.id)+")"}).each(n.ra);t.append("line").attr("class","cell_border").attr("x2",n.R).attr("pointer-events","none"),t.append("rect").attr("x",-200).attr("width",200).attr("height",n.a.b.d-n.o).style("fill","white").attr("class","backgroundRow");var a=t.append("text").attr("class","rtext").attr("x",-6).attr("y",i.rangeBand()/2).attr("dy",".32em").attr("text-anchor","end").text(function(t,a){return n.r(t,a)}).attr("style",function(){return"font-size:"+n.V+"em;"}).on("click",n.ga).on("mouseover",n.sa).on("mouseout",n.ta);a.append("svg:title").text(function(t,a){return n.r(t,a)})},this._=function(){var t=n.ea.da(".column").data(n.v).enter().append("g").attr("class",function(t,a){var e=n.C(t,a);return e+=" column"}).attr("transform",function(t){return"translate("+e(t.id)+")rotate(-90)"});if(t.append("line").attr("class","cell_border").attr("x1",-n.S).attr("pointer-events","none"),"undefined"!=typeof n.w){n.a.n&&n.ua(t);var a=n.w.slice(0);a.sort(function(t,a){return d3.ascending(t.name,a.name)});for(var i=0;i<a.length;i++)n.na("x",a[i].id,1,0),d3.select("#gradient_x_"+a[i].id).select("#stop2").attr("stop-color","#333333")}t.append("rect").attr("width",100).attr("height",n.a.b.d-n.o).style("fill-opacity",function(){return"undefined"==typeof n.D?"0":void 0}).style("fill",function(t,a){if("undefined"==typeof n.D)return"white";var e="gradient_x_"+n.D(n.v[a].id).id;return"url(#"+e+")"}).attr("class","backgroundColumn");var r=t.append("text").attr("class","ctext").attr("x",6).attr("y",e.rangeBand()/2).attr("text-anchor","start").text(function(t,a){var e=n.y(t,a);return e.length>n.a.h.j&&(e=e.substring(0,n.a.h.j)+"..."),e}).attr("style",function(){return"font-size:"+n.V+"em;"}).attr("dy",".42em").on("click",n.ha).on("mouseover",n.va).on("mouseout",n.wa);r.append("svg:title").text(function(t,a){return n.y(t,a)})},this.ra=function(t){var a=d3.select(this).da(".cell").data(d3.values(n.L[t.id]).filter(function(t){var a=t[n.K];return"object"==typeof a?a.length:0})).enter().append("svg").attr("class","cell").attr("x",function(a){var i=Object.keys(n.L[t.id]),r=i.find(function(e){return n.L[t.id][e]===a});return e(r)}).on("mouseover",n.xa).on("mouseout",n.ya).on("mousedown",n.za).on("mouseup",n.qa);a.append("rect").attr("width",e.rangeBand()).attr("height",i.rangeBand()).style("fill",function(t){return n.G(t.institution)}),a.append("text").text(function(t){var a=t[n.K].reduce(function(t){return t+1},0);return t.Aa=a,a}).attr("x",function(){return e.rangeBand()/2}).attr("y",i.rangeBand()/2).attr("text-anchor","middle").attr("dominant-baseline","central").attr("width",e.rangeBand()).attr("height",i.rangeBand()).attr("style","font-size: "+.8*n.V+"em;").attr("fill","black")},this.ua=function(t){var a=[],i=[];t.each(function(t,r){var o=n.v[r],d=n.D(o.id).id,s=e(t.id);d in a?s<a[d]?a[d]=s:s>i[d]&&(i[d]=s):(a[d]=s,i[d]=s)});var r=(n.a.b.c-n.T)/2,o=13-n.T/2;this.ea.da(".bracket").data(Object.keys(a)).enter().append("g").each(function(t){n.D(t),n.Ba(n.ea,i[t]+r+o-2,-90,a[t]-r+o+2,-90),n.Ca(n.ea,a[t],i[t],100,r,n.B(t),t)}),d3.da(".column_category").on("mouseover",n.Da).on("mouseout",n.Ea).on("click",n.ia)},this.Da=function(t){d3.da("#gradient_x_"+t).select("#stop2").transition().duration(200).attr("stop-opacity",.35)},this.Ea=function(){d3.da(".defs_x").select("#stop2").transition().duration(400).attr("stop-opacity",0)},this.na=function(t,a,e,i){var r=100*e,o=100*(1-e),d=n.ea.append("svg:defs").attr("class","defs_"+t).append("svg:linearGradient").attr("id","gradient_"+t+"_"+a).attr("x1",r+"%").attr("y1","0%").attr("x2",o+"%").attr("y2","0%").attr("spreadMethod","pad");d.append("svg:stop").attr("id","stop1").attr("offset","0%").attr("stop-color","#FFFFFF").attr("stop-opacity",0),d.append("svg:stop").attr("id","stop2").attr("offset","100%").attr("stop-color","#FFFFFF").attr("stop-opacity",i)},this.xa=function(t){d3.da(".row .rtext").classed("active",function(a){return-1!==d3.values(n.L[a.id]).indexOf(t)}),d3.da(".column .ctext").classed("active",function(a){for(var e in n.L)if(n.L.hasOwnProperty(e)&&n.L[e][a.id]===t)return!0;return!1}),n.M&&(n.aa(t,n.N),n.ca())},this.za=function(t){n.N=!t.ba,n.aa(t,n.N),n.ca(),n.M=!0},this.ya=function(){d3.da("text").classed("active",!1)},this.sa=function(t){d3.da(".row .rtext").classed("active",function(a){return t.id===a.id})},this.ta=function(){d3.da("text").classed("active",!1)},this.va=function(t){d3.da(".column .ctext").classed("active",function(a){return t.id===a.id})},this.wa=function(){d3.da("text").classed("active",!1)},this.qa=function(){n.M&&(n.M=!1,n.J())},this.Ba=function(t,a,n,e,i){t.append("path").attr("style","stroke: #999999; stroke-width: 0.5px; fill: none;").attr("d",function(){var t=8,r=.6,o=a-e,d=n-i,s=Math.sqrt(o*o+d*d);o/=s,d/=s;var c=a+r*t*d,u=n-r*t*o,f=a-.25*s*o+(1-r)*t*d,l=n-.25*s*d-(1-r)*t*o,h=a-.5*s*o+t*d,p=n-.5*s*d-t*o,v=e+r*t*d,g=i-r*t*o,y=a-.75*s*o+(1-r)*t*d,m=n-.75*s*d-(1-r)*t*o;return"M "+a+" "+n+" Q "+c+" "+u+" "+f+" "+l+" T "+h+" "+p+" M "+e+" "+i+" Q "+v+" "+g+" "+y+" "+m+" T "+h+" "+p})},this.Ca=function(t,a,n,e,i,r,o){var d=(n-a)/2;t.append("text").data(o).attr("class","column_category").attr("style","fill: #AAAAAA;").attr("x",e).attr("dy",".32em").text(r).attr("transform",function(){return"translate("+(a+d+i)+")rotate(-90)"})},this.Y=function(){n.Q.remove(),n.Q=n.P.append("div"),n.Q.attr("style","display:flex; justify-content:center; width:100%; height:100%;"),n.Q.append("div").attr("id","noDatasetsMessageDiv").attr("style","align-self: center; font-size: large;").append("span").attr("id","noDatasetsMessageSpan").text("No datasets available for the current settings!")}},DigViewerLabelDecorator=function(){"use strict";this.ma=function(){return 1},this.oa=function(){},this.pa=function(){}};
